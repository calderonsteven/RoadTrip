<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Road Trip</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Steven Calderon">

    <!-- Le styles -->
    <!--<link href="assets/css/bootstrap.css" rel="stylesheet">-->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
    #mapContainer{
		height: 400px;
		background-color: #f5f5f5;
		width: 100%;
	  }
    </style>
    <!--<link href="assets/css/bootstrap-responsive.css" rel="stylesheet">-->

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="assets/ico/favicon.png">
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Road Trip</a>
          <div class="nav-collapse collapse">
            <!--<p class="navbar-text pull-right">
              Logged in as <a href="#" class="navbar-link">Username</a>
            </p> -->
            <ul class="nav">
              <li class="active"><a href="#">Inicio</a></li>
              <li><a href="#about">El Viaje</a></li>
              <li><a href="#contact">El tumblr</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">Fotos Recorrido</li>
              <li class="active">
				        <img id="imgTest" class="img-rounded"src="" /> 
			        </li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span9">
          <div id="mapContainer" class="container">
			       <div id="map" style="width: 100%; height: 100%;float:left;"></div>	
          </div>         
        </div><!--/span-->
      </div><!--/row-->

      <hr>
      <footer>
        <p>&copy; The Cookies Corporation 2013</p>
      </footer>
    </div><!--/.fluid-container-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--<script src="assets/js/jquery.js"></script>-->
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	
	<!--
    <script src="assets/js/bootstrap-transition.js"></script>
    <script src="assets/js/bootstrap-alert.js"></script>
    <script src="assets/js/bootstrap-modal.js"></script>
    <script src="assets/js/bootstrap-dropdown.js"></script>
    <script src="assets/js/bootstrap-scrollspy.js"></script>
    <script src="assets/js/bootstrap-tab.js"></script>
    <script src="assets/js/bootstrap-tooltip.js"></script>
    <script src="assets/js/bootstrap-popover.js"></script>
    <script src="assets/js/bootstrap-button.js"></script>
    <script src="assets/js/bootstrap-collapse.js"></script>
    <script src="assets/js/bootstrap-carousel.js"></script>
    <script src="assets/js/bootstrap-typeahead.js"></script>-->

	<!-- custom scripts
    ================================================== -->
    <!-- aqui van los scripts de la logica de la pagina -->
	<script src="http://www.nihilogic.dk/labs/binaryajax/binaryajax.js"></script>
	<script src="http://www.nihilogic.dk/labs/exif/exif.js"></script>
	<!--<script src="http://www.nihilogic.dk/labs/exifjquery/jquery.exif.js"></script>-->	
	<script src="http://maps.google.com/maps?file=api&amp;key=AIzaSyCcCKiU3CdLVwprqErPNyQAj56jvxE_lp0"></script>
	
	<script>

		var oMap = new GMap2(document.getElementById("map"));
		var oMarker;

		$("#btnLoad").click(function() {
			extractGeoInfo("test.jpg");
		});

		function extractGeoInfo(imgSrc){
			//http://www.nihilogic.dk/labs/exifjquery/
			//http://www.nihilogic.dk/labs/gps_exif_google_maps/			
			var oImg = new Image();  
			oImg.onload = function() {  
				EXIF.getData(oImg,   
					function() {  
						var aLat = EXIF.getTag(oImg, "GPSLatitude");  
						var aLong = EXIF.getTag(oImg, "GPSLongitude");  
			  
						if (!(aLat && aLong)) { alert("whoops, no GPS info "); return; } // whoops, no GPS info  
			  
						// convert from deg/min/sec to decimal for Google  
						var strLatRef = EXIF.getTag(oImg, "GPSLatitudeRef") || "N";  
						var strLongRef = EXIF.getTag(oImg, "GPSLongitudeRef") || "W";  
						var fLat = (aLat[0] + aLat[1]/60 + aLat[2]/3600) * (strLatRef == "N" ? 1 : -1);  
						var fLong = (aLong[0] + aLong[1]/60 + aLong[2]/3600) * (strLongRef == "W" ? -1 : 1);  
			  
						// center the google map and add a marker  
						oMap.setCenter(new GLatLng(fLat, fLong), 13);  
						oMarker = new GMarker(new GLatLng(fLat, fLong));  
						oMap.addOverlay(oMarker);  
						
						//only for debug
						var msg = "GPSLatitude:"+ fLat + ", GPSLongitude:"+ fLong;						
						//$("#exifData").html(msg);
						//console.log(msg);		
						//alert(msg);
						$("#imgTest").attr("src", oImg.src);
						//only for debug
					}  
				);  
			}  
				  
			oImg.src = imgSrc;		
		}
		
		extractGeoInfo("test.jpg");

    ///// loadFromTumblr
    function loadFromTumblr() {
        //$('.nav nav-list').empty();
        var tumblrName = "img-roadtrip";//$('#tumblr_name').val();
 
        //Tumblr retrieval
        $.getJSON("http://" + tumblrName + ".tumblr.com/api/read/json?callback=?",
                function (data) {
                    $.each(data.posts, function (i, posts) {
                        var photo500 = this['photo-url-500'];
                        if (photo500 == undefined) return;
                        photo500 = "//24.media.tumblr.com/bde93ea9012ca6f2ccaaf7a9410f0a52/tumblr_mjl283ypj31s8srpmo1_500.jpg";
                        var newLi = '<li><img id="imgTest" class="img-rounded"src="' + photo500 + '" /></li>';
                        $('.nav-list').append(newLi);;
                    });
                    addClickEventToImages();
                });
    }

    function addClickEventToImages(){
       $('.nav-list li img').click(function(){
          var srcImg = $(this).attr("src");
          extractGeoInfo(srcImg);
       });
    }
    loadFromTumblr();


	</script>
  </body>
</html>
